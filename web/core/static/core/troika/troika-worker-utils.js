/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.17.1.
 * Original file: /npm/troika-worker-utils@0.47.2/dist/troika-worker-utils.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};"function"==typeof e.setTimeout&&setTimeout,"function"==typeof e.clearTimeout&&clearTimeout;function n(e,n){this.fun=e,this.array=n}n.prototype.run=function(){this.fun.apply(null,this.array)};var r=e.performance||{};r.now||r.mozNow||r.msNow||r.oNow||r.webkitNow;new Date;function t(){var e=Object.create(null);function n(t,o){var a=t.id,i=t.name,u=t.dependencies;void 0===u&&(u=[]);var s=t.init;void 0===s&&(s=function(){});var c=t.getTransferables;if(void 0===c&&(c=null),!e[a])try{u=u.map((function(r){return r&&r.isWorkerModule&&(n(r,(function(e){if(e instanceof Error)throw e})),r=e[r.id].value),r})),s=r("<"+i+">.init",s),c&&(c=r("<"+i+">.getTransferables",c));var l=null;"function"==typeof s?l=s.apply(void 0,u):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:l,getTransferables:c},o(l)}catch(e){e&&e.noLog||console.error(e),o(e)}}function r(e,n){var r=void 0;self.troikaDefine=function(e){return r=e};var t=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+n+"\n)"],{type:"application/javascript"}));try{importScripts(t)}catch(e){console.error(e)}return URL.revokeObjectURL(t),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var t=r.data,o=t.messageId,a=t.action,i=t.data;try{"registerModule"===a&&n(i,(function(e){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===a&&function(n,r){var t,o=n.id,a=n.args;e[o]&&"function"==typeof e[o].value||r(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(t=e[o]).value.apply(t,a);i&&"function"==typeof i.then?i.then(u,(function(e){return r(e instanceof Error?e:new Error(""+e))})):u(i)}catch(e){r(e)}function u(n){try{var t=e[o].getTransferables&&e[o].getTransferables(n);t&&Array.isArray(t)&&t.length||(t=void 0),r(n,t)}catch(e){console.error(e),r(e)}}}(i,(function(e,n){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:e},n||void 0)}))}catch(e){postMessage({messageId:o,success:!1,error:e.stack})}}))}var o=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return o=function(){return e},e},a=0,i=0,u=!1,s=Object.create(null),c=Object.create(null),l=Object.create(null);function f(e){if(!(e&&"function"==typeof e.init||u))throw new Error("requires `options.init` function");var n=e.dependencies,r=e.init,t=e.getTransferables,i=e.workerId;if(!o())return function(e){var n=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return n._getInitResult().then((function(n){if("function"==typeof n)return n.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return n._getInitResult=function(){var r=e.dependencies,t=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var o=Promise.all(r).then((function(e){return t.apply(null,e)}));return n._getInitResult=function(){return o},o},n}(e);null==i&&(i="#default");var s="workerModule"+ ++a,l=e.name||s,d=null;function g(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(!d){d=w(i,"registerModule",g.workerModuleData);var r=function(){d=null,c[i].delete(r)};(c[i]||(c[i]=new Set)).add(r)}return d.then((function(n){if(n.isCallable)return w(i,"callModule",{id:s,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return n=n&&n.map((function(e){return"function"!=typeof e||e.workerModuleData||(u=!0,e=f({workerId:i,name:"<"+l+"> function dependency: "+e.name,init:"function(){return (\n"+p(e)+"\n)}"}),u=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),g.workerModuleData={isWorkerModule:!0,id:s,name:l,dependencies:n,init:p(r),getTransferables:t&&p(t)},g}function d(e){c[e]&&c[e].forEach((function(e){e()})),s[e]&&(s[e].terminate(),delete s[e])}function p(e){var n=e.toString();return!/^function/.test(n)&&/^\w+\s*\(/.test(n)&&(n="function "+n),n}function w(e,n,r){return new Promise((function(o,a){var u=++i;l[u]=function(e){e.success?o(e.result):a(new Error("Error in worker "+n+" call: "+e.error))},function(e){var n=s[e];if(!n){var r=p(t);(n=s[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var n=e.data,r=n.messageId,t=l[r];if(!t)throw new Error("WorkerModule response with empty or unknown messageId");delete l[r],t(n)}}return n}(e).postMessage({messageId:u,action:n,data:r})}))}export{f as defineWorkerModule,p as stringifyFunction,d as terminateWorker};export default null;

{% extends "core/base.html" %}
{% block content %}

    <div class="row">
        <div class="col-sm-4">
            <h1>{{ product.name }}</h1>
            <form method="post">{% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Update">
            </form>
            <a href="{% url 'easel:index' %}">Back</a>
        </div>
        <div id='d3' class="col-sm-4 "></div>
    </div>



    <script type="module">
        import * as THREE from 'three';

        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        d3 = document.getElementById("d3");


        const renderer = new THREE.WebGLRenderer();
        renderer.setSize( d3.offsetWidth, d3.offsetHeight );
        d3.appendChild( renderer.domElement );

        function update_viewport() {
            camera.aspect = d3.offsetWidth / d3.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( d3.offsetWidth, d3.offsetHeight );
        };

        window.onresize = function(){
            update_viewport();
        };
        

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera( 75, d3.width / d3.offsetHeight, 0.1, 1000 );
        camera.position.z = 250;

        const controls = new OrbitControls( camera, renderer.domElement );
        controls.target.set( 0, 0, 0 );
        controls.update();
        controls.enablePan = false;
        controls.enableDamping = true;

        const light = new THREE.AmbientLight( 0x404040 ); // soft white light
        scene.add( light );

        let model;

        //const geometry = new THREE.BoxGeometry( 1, 1, 1 );
        //const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
        //const cube = new THREE.Mesh( geometry, material );
        //scene.add( cube );
        const loader = new GLTFLoader();
        loader.load( '{{ product.glb.url }}', function ( gltf ) {
            scene.add( gltf.scene );
            model = gltf
            animate();
        }, undefined, function ( error ) {
            console.error( error );
        } );

        

        function animate() {
            requestAnimationFrame( animate );

            //model.rotation.x += 0.01;
            //model.rotation.y += 0.01;

            controls.update();

            renderer.render( scene, camera );
        };

        update_viewport();
    </script>


{% endblock %}